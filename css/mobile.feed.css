/* /css/mobile.feed.css */

/* =========================
   Mobile scrolling + snap
   ========================= */

body.is-mobile {
  overflow-y: auto;
  overflow-x: hidden;

  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;

  scroll-snap-type: y mandatory;
  scroll-behavior: smooth;

  margin: 0;
}

body.is-mobile #m-root {
  position: relative;
  width: 100%;
  z-index: 10000;

  padding-top: var(--m-header-h);
  background: transparent;
}

body.is-mobile #m-root,
body.is-mobile #m-acasa {
  margin: 0;
  padding: 0;
}

/* Each snap screen is FULL viewport */
body.is-mobile .m-panel {
  position: relative;
  width: 100%;

  height: 100dvh;
  height: 100vh;

  overflow: hidden; /* keep (used across screens) */

  scroll-snap-align: start;
  scroll-snap-stop: always;

  background: transparent;
}

/* Overscan panels slightly to hide seams
   ✅ BUT do NOT touch the 2-screen feed panel height */
body.is-mobile .m-panel:not(.m-feed-panel) {
  height: calc(100dvh + 5px);
  height: calc(100vh + 5px);
}

/* =========================
   Subtle down hint
   ========================= */

body.is-mobile .m-down {
  position: absolute;
  left: 50%;
  bottom: 16px;
  transform: translateX(-50%);
  z-index: 6;

  width: 28px;
  height: 28px;
  border-radius: 999px;

  display: grid;
  place-items: center;

  color: rgba(255,255,255,0.75);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 16px;
  line-height: 1;

  background: rgba(0,0,0,0.20);
  border: 1px solid rgba(255,255,255,0.10);
  backdrop-filter: blur(8px);

  animation: mDownPulse 1400ms ease-in-out infinite;
  pointer-events: none;
}

@keyframes mDownPulse {
  0%, 100% { transform: translateX(-50%) translateY(0); opacity: 0.65; }
  50%      { transform: translateX(-50%) translateY(-6px); opacity: 0.95; }
}

/* =========================
   Caption base
   ========================= */

body.is-mobile .m-hero-cap {
  position: absolute;
  left: 16px;
  right: 16px;
  bottom: 14px;
  width: auto;
  z-index: 6;

  color: rgba(255,255,255,0.92);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

body.is-mobile .m-hero-title {
  font-size: 20px;
  font-weight: 650;
  line-height: 1.1;
  letter-spacing: -0.2px;
  margin: 0;
  text-shadow: 0 6px 20px rgba(0,0,0,0.55);
}

body.is-mobile .m-hero-hint {
  margin-top: 6px;
  font-size: 12px;
  color: rgba(255,255,255,0.70);
  text-shadow: 0 6px 20px rgba(0,0,0,0.55);
}

/* =========================
   Banner carousel (Screen 2)
   Transform-based (NO native horizontal scroll container)
   ========================= */

body.is-mobile .m-banner-rail {
  user-select: none;
  position: absolute;
  inset: 0;

  overflow: hidden;

  /* ✅ critical: allow vertical scroll gestures through */
  touch-action: pan-y;

  -webkit-overflow-scrolling: touch;
}

body.is-mobile .m-banner-track {
  height: 100%;
  display: flex;
  will-change: transform;
  transform: translate3d(0,0,0);
  transition: transform 340ms cubic-bezier(.2,.8,.2,1);
}

body.is-mobile .m-banner-rail.is-dragging .m-banner-track {
  transition: none;
}

body.is-mobile .m-banner-slide {
  flex: 0 0 100%;
  height: 100%;
}

body.is-mobile .m-banner-slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  pointer-events: none;

  user-select: none;
  -webkit-user-drag: none;
}

/* =========================
   Ticker overlay (Screen 2)
   ========================= */

body.is-mobile .m-ticker-overlay {
  position: absolute;
  top: 200px;
  left: 50px;
  width: 500px;
  z-index: 5;

  background: transparent;
  border: 0;
  padding: 0;

  opacity: 0;
  transform: translateY(8px);
  transition: opacity 260ms ease, transform 260ms ease;
}

body.is-mobile #m-acasa-screen.is-live .m-ticker-overlay {
  opacity: 1;
  transform: translateY(0);
}

body.is-mobile .m-ticker-line {
  margin: 0;
  max-width: 500px;

  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 40px;
  line-height: 1.06;
  font-weight: 650;
  letter-spacing: -0.5px;

  color: rgba(255,255,255,0.92);
  text-shadow: 0 6px 20px rgba(0,0,0,0.55);
}

/* Word-by-word reveal */
body.is-mobile .m-word {
  display: inline-block;
  opacity: 0;
  transform: translateY(10px);
  filter: blur(2px);
  will-change: transform, opacity, filter;
  animation: mWordIn 520ms cubic-bezier(.2,.8,.2,1) forwards;
}

@keyframes mWordIn {
  to { opacity: 1; transform: translateY(0); filter: blur(0); }
}

/* Do not animate until Screen2 is live */
body.is-mobile #m-acasa-screen:not(.is-live) .m-word {
  animation: none;
  opacity: 0;
  transform: translateY(10px);
  filter: blur(2px);
}

/* =========================
   ✅ Hero FEED panel (2 screens tall, CONTENT FILLS HEIGHT)
   ========================= */

body.is-mobile .m-panel.m-feed-panel {
  height: 200dvh !important;
  height: 200vh !important;

  overflow: hidden;
  scroll-snap-align: start;
  scroll-snap-stop: always;

  background: transparent;
}

/* The feed must fill the entire panel height */
body.is-mobile .m-feed {
  height: 100%;
  box-sizing: border-box;

  padding: 0;

  display: grid;
  grid-template-rows: repeat(6, 1fr);

  gap: 0;
}

/* Each card stretches to its grid row */
body.is-mobile .m-hero-card {
  position: relative;
  height: 100%;
  min-height: 180px;

  border-radius: 0;
  overflow: hidden;

  box-shadow: none;
  border: 0;
  background: transparent;
  backdrop-filter: none;
}

body.is-mobile .m-hero-btn {
  width: 100%;
  height: 100%;
  border: 0;
  padding: 0;
  background: transparent;
  color: inherit;
  cursor: pointer;
  display: block;
  -webkit-tap-highlight-color: transparent;
  min-height: 44px;
}

/* Media fills the card */
body.is-mobile .m-hero-media {
  position: absolute;
  inset: 0;
  overflow: hidden;
}

/* ✅ Parallax-ready image: larger than container so it can drift */
body.is-mobile .m-hero-media img {
  position: absolute;
  left: 0;
  top: -18%;
  width: 100%;
  height: 136%;
  object-fit: cover;
  display: block;

  will-change: transform;
  transform: translate3d(0,0,0);
  user-select: none;
  -webkit-user-drag: none;
}

/* Caption overlay stays at bottom */
body.is-mobile .m-hero-card .m-hero-cap {
  left: 16px;
  right: 16px;
  bottom: 14px;
}

/* Caption readability */
body.is-mobile .m-hero-card .m-hero-cap::before {
  content: "";
  position: absolute;
  inset: -18px;
  background: linear-gradient(to top, rgba(0,0,0,0.55), rgba(0,0,0,0));
  z-index: -1;
}

/* =========================
   Background + mobile transparency
   ========================= */

body.is-mobile #bg {
  position: fixed;
  inset: 0;
  z-index: 0;
}

body.is-mobile #wrapper,
body.is-mobile #stage {
  background: transparent !important;
}

/* =========================
   Screen 1 intro brand (wordmark + caustics)
   Sunrise reveal (NO CLIPPING)
   ========================= */

/*
  IMPORTANT RULES:
  - NO overflow:hidden / clip-path / mask on any wrapper containing .m-brand-caustics
  - If clip-path is used, it is applied ONLY to the wordmark image (.m-brand-img)
*/

body.is-mobile .m-intro-brand {
  position: fixed;                /* keep caustics independent from .m-panel overflow */
  left: 50%;
  top: calc(50% + 100px);         /* ✅ exact: 100px below center */
  transform: translate(-50%, -50%) translateY(18px);

  z-index: 12000;
  width: min(86vw, 520px);
  pointer-events: none;

  /* hidden until Screen 1 is active AND reveal class is applied */
  opacity: 0;

  /* MUST NOT clip caustics */
  overflow: visible;
}

body.is-mobile .m-brand-wrap {
  position: relative;
  display: block;

  /* MUST NOT clip caustics */
  overflow: visible;
}

/* --- Sunrise haze BEHIND (subtle) --- */
body.is-mobile .m-brand-wrap::before {
  content: "";
  position: absolute;
  left: 50%;
  top: 58%;
  transform: translate(-50%, -50%);
  width: 140%;
  height: 90%;
  pointer-events: none;
  z-index: -1;

  background: radial-gradient(closest-side,
    rgba(255,175,110,0.18),
    rgba(255,160,100,0.07) 55%,
    rgba(0,0,0,0) 78%
  );
  filter: blur(16px);
  opacity: 0;

  transition: opacity 900ms ease;
}

/* Wordmark image (sunrise reveal) */
body.is-mobile .m-brand-img {
  display: block;
  width: 100%;
  height: auto;

  opacity: 0;
  transform: translateY(14px);
  will-change: opacity, transform, clip-path;

  /* reveal-from-below (image only!) */
  clip-path: inset(100% 0 0 0);

  filter:
    drop-shadow(0 12px 32px rgba(0,0,0,0.30))
    drop-shadow(0 0 18px rgba(255,190,120,0.22));
}

/* Caustics layer (must spill beyond wordmark bounds) */
body.is-mobile .m-brand-caustics {
  position: absolute;

  /* Bigger than the wordmark box so it can spill OUTSIDE */
  inset: -32%;

  pointer-events: none;
  overflow: visible;

  /* subtle, embedded */
  mix-blend-mode: screen;

  opacity: 0;
  transition: opacity 1100ms ease;

  will-change: transform, filter;
  transform: translate3d(0,0,0);

  /* softer than your “stronger” block */
  filter: blur(1px) contrast(145%) brightness(1.12) saturate(125%);

  animation:
    mCausticsDrift 4.6s ease-in-out infinite alternate,
    mCausticsShimmer 1.65s linear infinite;
}

/* Caustics “light” texture */
body.is-mobile .m-brand-caustics {
  background:
    radial-gradient(closest-side at 18% 35%, rgba(255,220,180,0.32), rgba(255,255,255,0) 60%),
    radial-gradient(closest-side at 62% 22%, rgba(255,210,160,0.20), rgba(255,255,255,0) 62%),
    radial-gradient(closest-side at 78% 68%, rgba(255,225,185,0.24), rgba(255,255,255,0) 58%),
    radial-gradient(closest-side at 32% 74%, rgba(255,200,150,0.16), rgba(255,255,255,0) 64%);
}

/* --- Active state gates --- */
/* Screen1 must be active (body.m-intro-on) AND intro element must have m-brand-in */
body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-intro-brand {
  opacity: 1;
  transform: translate(-50%, -50%) translateY(0);
  transition: opacity 900ms ease, transform 900ms cubic-bezier(.2,.8,.2,1);
}

body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-brand-wrap::before {
  opacity: 1;
}

body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-brand-img {
  opacity: 1;
  transform: translateY(0);
  clip-path: inset(0 0 0 0);
  transition:
    opacity 900ms ease,
    transform 900ms cubic-bezier(.2,.8,.2,1),
    clip-path 1100ms cubic-bezier(.2,.8,.2,1);
}

/* ✅ Required exact behavior: caustics opacity when active */
body.is-mobile.m-intro-on #m-acasa-intro.m-caustics-in .m-brand-caustics {
  opacity: 0.28;
}

/* Caustics motion (kept from your working baseline, but non-aggressive) */
@keyframes mCausticsDrift {
  0%   { transform: translate3d(-7%, -6%, 0) scale(1.14); }
  50%  { transform: translate3d(7%, 5%, 0) scale(1.20); }
  100% { transform: translate3d(-4%, 7%, 0) scale(1.16); }
}

@keyframes mCausticsShimmer {
  0%   { filter: blur(1px) contrast(140%) brightness(1.10) saturate(122%); }
  50%  { filter: blur(1px) contrast(158%) brightness(1.18) saturate(130%); }
  100% { filter: blur(1px) contrast(145%) brightness(1.12) saturate(125%); }
}

/* =========================
   Motion safety
   ========================= */

@media (prefers-reduced-motion: reduce) {
  body.is-mobile {
    scroll-behavior: auto;
  }

  body.is-mobile .m-word {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
    filter: none !important;
  }

  body.is-mobile .m-hero-media img {
    transform: none !important;
  }

  body.is-mobile .m-intro-brand,
  body.is-mobile .m-brand-img,
  body.is-mobile .m-brand-caustics,
  body.is-mobile .m-brand-wrap::before {
    transition: none !important;
    animation: none !important;
    transform: none !important;
    clip-path: none !important;
  }

  body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-intro-brand {
    opacity: 1 !important;
  }

  body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-brand-img {
    opacity: 1 !important;
  }

  body.is-mobile.m-intro-on #m-acasa-intro.m-caustics-in .m-brand-caustics {
    opacity: 0.28 !important;
  }
}
