/* /css/mobile.feed.css */

/* =========================
   MOBILE: use #m-root as the ONLY scroller
   (avoids desktop fixed-layout rules killing document scroll)
   ========================= */

html.is-mobile,
body.is-mobile{
  height: 100%;
  overflow: hidden;          /* prevent document scrolling */
}

/* #m-root becomes the viewport scroller */
body.is-mobile #m-root{
  position: fixed;
  inset: 0;
  overflow-y: auto;
  overflow-x: hidden;

  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;

  padding-top: var(--m-header-h);
  box-sizing: border-box;

  background: transparent;
  z-index: 10000;
}


body.is-mobile {
  --m-ui-scale: 0.67; /* ~33% smaller; adjust to match OG */
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

:root{
  --m-logo-x: calc(max(env(safe-area-inset-left), 0px) + var(--m-gap-logo-left, 20px));
}



body.is-mobile #m-root,
body.is-mobile #m-acasa {
  margin: 0;
  padding: 0;
}

/* Each snap screen is FULL viewport */
body.is-mobile .m-panel {
  position: relative;
  width: 100%;

  height: 100dvh;
  height: 100vh;

  overflow: hidden;
  background: transparent;

  /* ✅ no CSS snap on panels */
  scroll-snap-align: none;
  scroll-snap-stop: normal;
}


/* Overscan panels slightly to hide seams
   ✅ BUT do NOT touch the 2-screen feed panel height */
body.is-mobile .m-panel:not(.m-feed-panel) {
  height: calc(100dvh + 5px);
  height: calc(100vh + 5px);
}

/* =========================
   Subtle down hint
   ========================= */

body.is-mobile .m-down {
  position: absolute;
  left: 50%;
  bottom: 16px;
  transform: translateX(-50%) scale(var(--m-ui-scale));
  transform-origin: center;
  z-index: 6;

  width: 28px;
  height: 28px;
  border-radius: 999px;

  display: grid;
  place-items: center;

  color: rgba(255,255,255,0.75);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 16px;
  line-height: 1;

  background: rgba(0,0,0,0.20);
  border: 1px solid rgba(255,255,255,0.10);
  backdrop-filter: blur(8px);

  animation: mDownPulse 1400ms ease-in-out infinite;
  pointer-events: none;
}

@keyframes mDownPulse {
  0%, 100% { transform: translateX(-50%) translateY(0) scale(var(--m-ui-scale)); opacity: 0.65; }
  50%      { transform: translateX(-50%) translateY(-6px) scale(var(--m-ui-scale)); opacity: 0.95; }
}

/* =========================
   Caption base
   ========================= */

body.is-mobile .m-hero-cap {
  position: absolute;
  left: 16px;
  right: 16px;
  bottom: 14px;
  width: auto;
  z-index: 6;
  transform: scale(var(--m-ui-scale));
  transform-origin: left bottom;

  color: rgba(255,255,255,0.92);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

body.is-mobile .m-hero-title {
  font-size: clamp(16px, 4.8vw, 20px);
  font-weight: 650;
  line-height: 1.1;
  letter-spacing: -0.2px;
  margin: 0;
  text-shadow: 0 6px 20px rgba(0,0,0,0.55);
}

body.is-mobile .m-hero-hint {
  margin-top: 6px;
  font-size: clamp(11px, 3.2vw, 12px);
  color: rgba(255,255,255,0.70);
  text-shadow: 0 6px 20px rgba(0,0,0,0.55);
}

/* =========================================
   SCREEN 2: TOP STRIP + TICKER (clean + centered)
   ========================================= */
:root{
  --acasa-accent: var(--acasa-color, #ff6701);
  --m-strip-h: clamp(62px, 9vh, 92px);
  --m-strip-pad-x: clamp(12px, 4vw, 22px);
}

body.is-mobile #m-acasa-screen .m-topstrip{
  position: absolute;
  top: 0; left: 0; right: 0;
  height: var(--m-strip-h);
  z-index: 30;
  pointer-events: none; /* strip doesn't block vertical scroll */
}

body.is-mobile #m-acasa-screen .m-topstrip__glass{
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;

  padding: 0 var(--m-strip-pad-x);

  /* ✅ same "strip language" as bottom divider, but expanded */
  background: linear-gradient(to right,
    rgba(255,255,255,0.08),
    color-mix(in srgb, var(--acasa-accent) 55%, rgba(255,255,255,0.10)),
    rgba(255,255,255,0.08)
  );

  border-bottom: 1px solid rgba(255,255,255,0.14);

  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);

  box-shadow:
    0 10px 24px rgba(0,0,0,0.16),
    inset 0 1px 0 rgba(255,255,255,0.14);
}

/* =========================================
   SCREEN 2: BANNERS (crawler under strip)
   ========================================= */

body.is-mobile #m-acasa-screen .m-banner-rail{
  position: absolute;
  inset: 0;
  z-index: 10;
  overflow: hidden;

  /* allow normal vertical scrolling gestures */
  touch-action: pan-y;
  pointer-events: auto;
}

body.is-mobile #m-acasa-screen .m-banner-track{
  height: 100%;
  display: flex;
  flex-wrap: nowrap;
  width: max-content;
  will-change: transform;
  transform: translate3d(0,0,0);
}

body.is-mobile #m-acasa-screen .m-banner-slide{
  flex: 0 0 100vw;
  width: 100vw;
  height: 100%;
  position: relative;
  overflow: hidden;
}

body.is-mobile #m-acasa-screen .m-banner-slide img{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  pointer-events: none;
  user-select: none;
  -webkit-user-drag: none;
}

/* subtle “pan hint” only while dragging (JS adds .is-dragging) */
body.is-mobile #m-acasa-screen .m-banner-rail.is-dragging::after{
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(to right,
    rgba(0,0,0,0.22),
    rgba(0,0,0,0) 22%,
    rgba(0,0,0,0) 78%,
    rgba(0,0,0,0.22)
  );
  opacity: 0.55;
}


/* Bottom divider strip */
body.is-mobile #m-acasa-screen .m-screen-divider{
  position: absolute;
  left: 0; right: 0; bottom: 0;
  height: 5px;
  z-index: 40;

  background: linear-gradient(to right,
    rgba(255,255,255,0.08),
    color-mix(in srgb, var(--acasa-accent) 55%, rgba(255,255,255,0.10)),
    rgba(255,255,255,0.08)
  );

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* =========================
   ✅ Hero FEED panel (free scroll, real feed)
   ========================= */

body.is-mobile .m-panel.m-feed-panel {
  /* keep your "2 screens tall" idea, but allow real feed scrolling */
  min-height: 200dvh;
  min-height: 200vh;

  height: auto;            /* ✅ allow content to define total height */
  overflow: visible;       /* ✅ do NOT clip the feed */
  background: transparent;
}

/* Feed is a normal vertical list */
body.is-mobile .m-feed {
  display: flex;
  flex-direction: column;
  gap: 0;
  padding: 0;
}

/* Each card is "viewport-ish" tall like a real feed */
body.is-mobile .m-hero-card {
  position: relative;

  /* portrait default: ~3/4 viewport height feel */
  height: 75vh;
  min-height: 420px;
  max-height: 860px;

  border-radius: 0;
  overflow: hidden;
  background: transparent;
  border: 0;
}

/* Landscape: 4:3 vibe (wider/shorter) */
@media (orientation: landscape) {
  body.is-mobile .m-hero-card {
    height: 58vh;          /* ✅ feels like "4:3" consumption */
    min-height: 320px;
    max-height: 620px;
  }
}

body.is-mobile .m-hero-btn {
  width: 100%;
  height: 100%;
  border: 0;
  padding: 0;
  background: transparent;
  color: inherit;
  cursor: pointer;
  display: block;
  -webkit-tap-highlight-color: transparent;
  min-height: 44px;
}

/* Media fills the card */
body.is-mobile .m-hero-media {
  position: absolute;
  inset: 0;
  overflow: hidden;
}

/* Parallax-ready image */
body.is-mobile .m-hero-media img {
  position: absolute;
  left: 0;
  top: -30%;        /* more headroom */
  width: 100%;
  height: 160%;     /* ✅ big overscan so it never reveals edges */
  object-fit: cover;

  will-change: transform;
  transform: translate3d(0,0,0);
  user-select: none;
  -webkit-user-drag: none;
}

/* Caption overlay stays at bottom */
body.is-mobile .m-hero-card .m-hero-cap {
  left: 16px;
  right: 16px;
  bottom: 14px;
}

/* Caption readability */
body.is-mobile .m-hero-card .m-hero-cap::before {
  content: "";
  position: absolute;
  inset: -18px;
  background: linear-gradient(to top, rgba(0,0,0,0.55), rgba(0,0,0,0));
  z-index: -1;
}


/* =========================
   Background + mobile transparency
   ========================= */

body.is-mobile #bg {
  position: fixed;
  inset: 0;
  z-index: 0;
}

body.is-mobile #wrapper,
body.is-mobile #stage {
  background: transparent !important;
}


body.is-mobile .m-intro-brand {
  position: fixed;                /* keep caustics independent from .m-panel overflow */
  left: 50%;
  top: calc(50% + 100px);         /* ✅ exact: 100px below center */
  transform: translate(-50%, -50%) translateY(18px) scale(var(--m-ui-scale));
  transform-origin: center;

  z-index: 12000;
  width: min(86vw, 520px);
  pointer-events: none;

  /* hidden until Screen 1 is active AND reveal class is applied */
  opacity: 0;

  /* MUST NOT clip caustics */
  overflow: visible;
}

body.is-mobile .m-brand-wrap {
  position: relative;
  display: block;

  /* MUST NOT clip caustics */
  overflow: visible;
}

/* --- Sunrise haze BEHIND (subtle) --- */
body.is-mobile .m-brand-wrap::before {
  content: "";
  position: absolute;
  left: 50%;
  top: 58%;
  transform: translate(-50%, -50%);
  width: 140%;
  height: 90%;
  pointer-events: none;
  z-index: -1;

  background: radial-gradient(closest-side,
    rgba(255,255,255,0.10),
    rgba(255,255,255,0.00) 72%
  ) !important;
  filter: blur(26px) !important;
  opacity: 0.55 !important;

  transition: opacity 900ms ease;
}

/* Wordmark image (sunrise reveal) */
body.is-mobile .m-brand-img {
  display: block;
  width: 100%;
  height: auto;

  opacity: 0;
  transform: translateY(14px);
  will-change: opacity, transform, clip-path;

  /* reveal-from-below (image only!) */
  clip-path: inset(100% 0 0 0);

  filter:
    drop-shadow(0 12px 32px rgba(0,0,0,0.30))
    drop-shadow(0 0 18px rgba(255,190,120,0.22));
}

/* Caustics layer (must spill beyond wordmark bounds) */
body.is-mobile .m-brand-caustics {
  position: absolute;

  /* Bigger than the wordmark box so it can spill OUTSIDE */
  inset: -32%;

  pointer-events: none;
  overflow: visible;

  /* subtle, embedded */
  mix-blend-mode: screen;

  opacity: 0;
  transition: opacity 1100ms ease;

  will-change: transform, filter;
  transform: translate3d(0,0,0);

  /* softer than your “stronger” block */
  filter: blur(1px) contrast(145%) brightness(1.12) saturate(125%);

  animation:
    mCausticsDrift 4.6s ease-in-out infinite alternate,
    mCausticsShimmer 1.65s linear infinite;
}

/* Caustics “light” texture */
body.is-mobile .m-brand-caustics {
  background:
    radial-gradient(closest-side at 18% 35%, rgba(255,220,180,0.32), rgba(255,255,255,0) 60%),
    radial-gradient(closest-side at 62% 22%, rgba(255,210,160,0.20), rgba(255,255,255,0) 62%),
    radial-gradient(closest-side at 78% 68%, rgba(255,225,185,0.24), rgba(255,255,255,0) 58%),
    radial-gradient(closest-side at 32% 74%, rgba(255,200,150,0.16), rgba(255,255,255,0) 64%);
}

/* --- Active state gates --- */
/* Screen1 must be active (body.m-intro-on) AND intro element must have m-brand-in */
body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-intro-brand {
  opacity: 1;
  transform: translate(-50%, -50%) translateY(0) scale(var(--m-ui-scale));
  transition: opacity 900ms ease, transform 900ms cubic-bezier(.2,.8,.2,1);
}

body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-brand-wrap::before {
  opacity: 1;
}

body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-brand-img {
  opacity: 1;
  transform: translateY(0);
  clip-path: inset(0 0 0 0);
  transition:
    opacity 900ms ease,
    transform 900ms cubic-bezier(.2,.8,.2,1),
    clip-path 1100ms cubic-bezier(.2,.8,.2,1);
}

/* ✅ Required exact behavior: caustics opacity when active */
body.is-mobile.m-intro-on #m-acasa-intro.m-caustics-in .m-brand-caustics {
  opacity: 0.28;
}

/* Caustics motion (kept from your working baseline, but non-aggressive) */
@keyframes mCausticsDrift {
  0%   { transform: translate3d(-7%, -6%, 0) scale(1.14); }
  50%  { transform: translate3d(7%, 5%, 0) scale(1.20); }
  100% { transform: translate3d(-4%, 7%, 0) scale(1.16); }
}

@keyframes mCausticsShimmer {
  0%   { filter: blur(1px) contrast(140%) brightness(1.10) saturate(122%); }
  50%  { filter: blur(1px) contrast(158%) brightness(1.18) saturate(130%); }
  100% { filter: blur(1px) contrast(145%) brightness(1.12) saturate(125%); }
}

/* =========================
   Motion safety
   ========================= */

@media (prefers-reduced-motion: reduce) {
  body.is-mobile {
    scroll-behavior: auto;
  }

  body.is-mobile .m-word {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
    filter: none !important;
  }

  body.is-mobile .m-hero-media img {
    transform: none !important;
  }

  body.is-mobile .m-intro-brand,
  body.is-mobile .m-brand-img,
  body.is-mobile .m-brand-caustics,
  body.is-mobile .m-brand-wrap::before {
    transition: none !important;
    animation: none !important;
    transform: none !important;
    clip-path: none !important;
  }

  body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-intro-brand {
    opacity: 1 !important;
  }

  body.is-mobile.m-intro-on #m-acasa-intro.m-brand-in .m-brand-img {
    opacity: 1 !important;
  }

  body.is-mobile.m-intro-on #m-acasa-intro.m-caustics-in .m-brand-caustics {
    opacity: 0.28 !important;
  }
}

/* If the PNG has a faint matte edge, this reduces the visibility */
body.is-mobile .m-brand-img{
  filter:
    drop-shadow(0 12px 32px rgba(0,0,0,0.30))
    drop-shadow(0 0 18px rgba(255,190,120,0.12)) !important;
}

/* =========================================================
   HARD FIX: Screen 2 top strip must NOT block vertical scroll
   - strip glass = pointer-events none
   - ticker viewport = pointer-events auto + pan-x
   ========================================================= */

body.is-mobile #m-acasa-screen .m-topstrip,
body.is-mobile #m-acasa-screen .m-topstrip__glass{
  pointer-events: none !important;
}

/* ✅ Ticker overlay: OUTSIDE strip, middle-left, same X as logo */
body.is-mobile #m-acasa-screen .m-ticker-overlay{
  position: absolute;

  /* “somewhere in the middle left” (tunable) */
  top: clamp(180px, 34vh, 360px);

  left: var(--m-logo-x);
  right: auto;

  width: clamp(240px, 34vw, 320px); /* “300px feel” */
  z-index: 35;

  /* do not block scrolling/dragging */
  pointer-events: none;

  opacity: 0;
  transform: translateY(10px);
  transition: opacity 260ms ease, transform 260ms ease;
}

/* Show + lift when screen2 becomes active (either class is fine) */
body.is-mobile #m-acasa-screen.is-live .m-ticker-overlay,
body.is-mobile #m-acasa-screen.ticker-live .m-ticker-overlay{
  opacity: 1;
  transform: translateY(0);
}


/* ✅ Ticker line: LEFT aligned + strong shadow */
body.is-mobile #m-acasa-screen .m-ticker-line{
  margin: 0;
  width: 100%;
  text-align: left;         /* ✅ correction */
  white-space: normal;      /* allow natural wrapping if needed */
  pointer-events: none;

  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: clamp(24px, 7vw, 32px); /* ~30px feel */
  line-height: 1.06;
  font-weight: 650;
  letter-spacing: -0.5px;

  color: rgba(255,255,255,0.92);
  text-shadow:
    0 10px 26px rgba(0,0,0,0.55),
    0 2px 10px rgba(0,0,0,0.35),
    0 0 22px rgba(0,0,0,0.25);

  transform: scale(var(--m-ui-scale));
  transform-origin: left center;
}

/* Banner area should allow vertical scroll gestures */
body.is-mobile #m-acasa-screen .m-banner-rail{
  touch-action: pan-y !important;
}

/* Screen 2: top strip should NOT block banner gestures */
body.is-mobile .m-topstrip,
body.is-mobile .m-topstrip__glass {
  pointer-events: none;
}

/* banners must accept input */
body.is-mobile .m-banner-rail {
  pointer-events: auto;
  touch-action: pan-y;        /* allow vertical scroll through by default */
}

/* Subtle pan hint (only while user drags) */
body.is-mobile .m-banner-rail.is-dragging {
  cursor: grabbing;
}

body.is-mobile .m-banner-rail.is-dragging::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;

  /* very subtle edge vignettes to suggest horizontal pan */
  background:
    linear-gradient(to right,
      rgba(0,0,0,0.22),
      rgba(0,0,0,0) 22%,
      rgba(0,0,0,0) 78%,
      rgba(0,0,0,0.22)
    );
  opacity: 0.55;
  transition: opacity 160ms ease;
}


/* =========================================
   Screen 2 ticker: word-by-word reveal (clean)
   - Hidden by default
   - Reveals when Screen 2 becomes live
   ========================================= */

body.is-mobile #m-acasa-screen .m-ticker-line .m-word{
  display: inline-block;
  opacity: 0;
  transform: translateY(10px);
  filter: blur(2px);
  will-change: transform, opacity, filter;
  animation: none;
}

/* ✅ Trigger reveal when screen2 is live (your JS already toggles .is-live) */
body.is-mobile #m-acasa-screen.is-live .m-ticker-line .m-word{
  animation: mWordIn 520ms cubic-bezier(.2,.8,.2,1) forwards;
}

/* Safety: if you ever toggle ticker-live instead, also support it */
body.is-mobile #m-acasa-screen.ticker-live .m-ticker-line .m-word{
  animation: mWordIn 520ms cubic-bezier(.2,.8,.2,1) forwards;
}

@keyframes mWordIn{
  to { opacity: 1; transform: translateY(0); filter: blur(0); }
}

